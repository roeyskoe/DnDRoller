@using System.ComponentModel.DataAnnotations;
@page "/"

<PageTitle>Index</PageTitle>

<div class="card bg-light mb-3">
    <div class="card-body">
        <button class="btn btn-lg btn-outline-dark" @onclick=NewGroup>New group</button>
    </div>
</div>

<div>
    <div class="d-flex flex-wrap">
        @for(int i = 0; i < Groups.Count;  i++)
        {
            <div class="card bg-light mb-3 p-1 m-2" style="max-width: 28.25rem">
                <GroupComponent @ref="GroupComponent" Group=@Groups[i]></GroupComponent>
            </div>
        }
    </div>
</div>

<div class="card bg-light mb-1" style="width: fit-content">
    <div class="card-body">
        <button class="btn btn-lg btn-outline-dark" @onclick=ThrowAll>Throw All</button>
    </div>
</div>

@code{
    private List<Group> Groups = new List<Group>();
    private List<GroupComponent> GroupComponents = new List<GroupComponent>();

    private int ngroups = 1;
    private int NGroups
    {
        get => ngroups;
        set
        {
            ngroups = value;
            Groups.Add(new Group(DestroyGroup));
        }
    }

    private GroupComponent GroupComponent
    {
        set
        {
            GroupComponents.Add(value);
        }
    }

    private void ThrowAll()
    {
        foreach (var groupc in GroupComponents)
        {
            groupc.Throw();
        }
    }

    private void NewGroup()
    {
        NGroups++;
    }

    private void DestroyGroup(Group group)
    {
        var test = Groups.Remove(group);
        ngroups--;
        StateHasChanged();
    }

    protected override void OnInitialized()
    {
        Groups.Add(new Group(DestroyGroup));
        base.OnInitialized();
    }
}